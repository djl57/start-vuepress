<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>promise | 个人文档</title>
    <meta name="description" content=" ">
    
    
    <link rel="preload" href="/assets/css/0.styles.2fbf6f8b.css" as="style"><link rel="preload" href="/assets/js/app.74b9e2df.js" as="script"><link rel="preload" href="/assets/js/25.446a0ad5.js" as="script"><link rel="prefetch" href="/assets/js/10.e632a29a.js"><link rel="prefetch" href="/assets/js/11.dbd541c8.js"><link rel="prefetch" href="/assets/js/12.d7d97395.js"><link rel="prefetch" href="/assets/js/13.578543e9.js"><link rel="prefetch" href="/assets/js/14.92fa8e73.js"><link rel="prefetch" href="/assets/js/15.844323a6.js"><link rel="prefetch" href="/assets/js/16.0a876930.js"><link rel="prefetch" href="/assets/js/17.9529e674.js"><link rel="prefetch" href="/assets/js/18.dcbb8fb3.js"><link rel="prefetch" href="/assets/js/19.9ae7125a.js"><link rel="prefetch" href="/assets/js/2.f2dab419.js"><link rel="prefetch" href="/assets/js/20.e662f03b.js"><link rel="prefetch" href="/assets/js/21.80a27f47.js"><link rel="prefetch" href="/assets/js/22.4a361f49.js"><link rel="prefetch" href="/assets/js/23.142f0f59.js"><link rel="prefetch" href="/assets/js/24.694f0bc6.js"><link rel="prefetch" href="/assets/js/26.7a2d1e6d.js"><link rel="prefetch" href="/assets/js/27.37511931.js"><link rel="prefetch" href="/assets/js/28.ece319f8.js"><link rel="prefetch" href="/assets/js/29.5ddef148.js"><link rel="prefetch" href="/assets/js/3.1b173d04.js"><link rel="prefetch" href="/assets/js/30.1ecbebce.js"><link rel="prefetch" href="/assets/js/31.421a0aae.js"><link rel="prefetch" href="/assets/js/32.d0439419.js"><link rel="prefetch" href="/assets/js/33.da4900c7.js"><link rel="prefetch" href="/assets/js/4.b7ea762e.js"><link rel="prefetch" href="/assets/js/5.46913dc1.js"><link rel="prefetch" href="/assets/js/6.8fd47d3f.js"><link rel="prefetch" href="/assets/js/7.068945ce.js"><link rel="prefetch" href="/assets/js/8.019a417a.js"><link rel="prefetch" href="/assets/js/9.186527cb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fbf6f8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人文档</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vpress/" class="nav-link">vuepress</a></div><div class="nav-item"><a href="/jsdoc/" class="nav-link router-link-active">js文档</a></div><div class="nav-item"><a href="/mdgram/" class="nav-link">md语法</a></div><div class="nav-item"><a href="https://github.com/djl57/start-vuepress" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vpress/" class="nav-link">vuepress</a></div><div class="nav-item"><a href="/jsdoc/" class="nav-link router-link-active">js文档</a></div><div class="nav-item"><a href="/mdgram/" class="nav-link">md语法</a></div><div class="nav-item"><a href="https://github.com/djl57/start-vuepress" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/jsdoc/" class="sidebar-link">目录</a></li><li><a href="/jsdoc/string.html" class="sidebar-link">字符串类型</a></li><li><a href="/jsdoc/number.html" class="sidebar-link">数字类型</a></li><li><a href="/jsdoc/boolean.html" class="sidebar-link">布尔类型</a></li><li><a href="/jsdoc/array.html" class="sidebar-link">数组</a></li><li><a href="/jsdoc/object.html" class="sidebar-link">对象</a></li><li><a href="/jsdoc/null.html" class="sidebar-link">null</a></li><li><a href="/jsdoc/undefined.html" class="sidebar-link">undefined</a></li><li><a href="/jsdoc/math.html" class="sidebar-link">Math对象</a></li><li><a href="/jsdoc/bibao.html" class="sidebar-link">闭包</a></li><li><a href="/jsdoc/promise.html" class="active sidebar-link">promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#promise构造函数" class="sidebar-link">Promise构造函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#语法" class="sidebar-link">语法</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#参数：-executor-：带有-resolve-和-reject-两个函数参数的函数" class="sidebar-link">参数：[executor]：带有 resolve 和 reject 两个函数参数的函数</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#参数说明：" class="sidebar-link">参数说明：</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#描述：" class="sidebar-link">描述：</a></li></ul></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#方法" class="sidebar-link">方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#promise-all-iterable" class="sidebar-link">Promise.all(iterable)</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#promise-race-iterable" class="sidebar-link">Promise.race(iterable)</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#promise-reject-reason" class="sidebar-link">Promise.reject(reason)</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#promise-resolve-value" class="sidebar-link">Promise.resolve(value)</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#catch" class="sidebar-link">catch()</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#then" class="sidebar-link">then()</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#finally" class="sidebar-link">finally()</a></li></ul></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#创建-promise" class="sidebar-link">创建 Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#promise-对象是由关键字-new-及其构造函数来创建的" class="sidebar-link">Promise 对象是由关键字 new 及其构造函数来创建的</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#想要让某个函数拥有-promise-功能，只需让其返回一个-promise-即可" class="sidebar-link">想要让某个函数拥有 promise 功能，只需让其返回一个 promise 即可</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#一个简单的例子" class="sidebar-link">一个简单的例子</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#一个高级一点的例子" class="sidebar-link">一个高级一点的例子</a></li></ul></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#使用-promise" class="sidebar-link">使用 Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#什么是-promise？" class="sidebar-link">什么是 Promise？</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#没有-promise-之前？" class="sidebar-link">没有 Promise 之前？</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#使用-promise-的好处？" class="sidebar-link">使用 Promise 的好处？</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#怎样使用-promise？" class="sidebar-link">怎样使用 Promise？</a></li><li class="sidebar-sub-header"><a href="/jsdoc/promise.html#如何创建-promise？" class="sidebar-link">如何创建 Promise？</a></li></ul></li></ul></li><li><a href="/jsdoc/async.html" class="sidebar-link">async await || yield function*</a></li><li><a href="/jsdoc/regexp.html" class="sidebar-link">正则表达式</a></li><li><a href="/jsdoc/class.html" class="sidebar-link">class类</a></li><li><a href="/jsdoc/decorator.html" class="sidebar-link">类的修饰器</a></li><li><a href="/jsdoc/module.html" class="sidebar-link">module模块</a></li><li><a href="/jsdoc/operator.html" class="sidebar-link">运算符</a></li><li><a href="/jsdoc/axios.html" class="sidebar-link">axios</a></li><li><a href="/jsdoc/fetch.html" class="sidebar-link">fetch</a></li><li><a href="/jsdoc/JSON.html" class="sidebar-link">JSON</a></li><li><a href="/jsdoc/copy.html" class="sidebar-link">克隆</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="promise"><a href="#promise" aria-hidden="true" class="header-anchor">#</a> promise</h1> <h2 id="promise构造函数"><a href="#promise构造函数" aria-hidden="true" class="header-anchor">#</a> Promise构造函数</h2> <h3 id="语法"><a href="#语法" aria-hidden="true" class="header-anchor">#</a> 语法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token comment">/* executor */</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h3 id="参数：-executor-：带有-resolve-和-reject-两个函数参数的函数"><a href="#参数：-executor-：带有-resolve-和-reject-两个函数参数的函数" aria-hidden="true" class="header-anchor">#</a> 参数：[executor]：带有 resolve 和 reject 两个函数参数的函数</h3> <h3 id="参数说明："><a href="#参数说明：" aria-hidden="true" class="header-anchor">#</a> 参数说明：</h3> <p>Promise构造函数执行时立即调用 executor 函数， resolve 和 reject 两个函数作为参数传递给executor（executor 函数在Promise构造函数返回新建对象前被调用）。resolve 和 reject 函数被调用时，分别将promise的状态改为fulfilled（完成）或rejected（失败）。</p> <p>executor 内部通常会执行一些异步操作，一旦完成，可以调用resolve函数来将promise状态改成fulfilled，或者在发生错误时将它的状态改为rejected。</p> <p>Promise构造函数执行时：</p> <ol><li>立即调用 executor  函数</li> <li>resolve 和 reject 函数被调用，分别将promise的状态改为fulfilled（完成）或rejected（失败）</li></ol> <hr> <h3 id="描述："><a href="#描述：" aria-hidden="true" class="header-anchor">#</a> 描述：</h3> <p>Promise 对象是一个代理对象（代理一个值），被代理的值在Promise对象创建时可能是未知的。它允许你为异步操作的成功和失败分别绑定相应的处理方法（handlers）。 这让异步方法可以像同步方法那样返回值，但并不是立即返回最终执行结果，而是一个能代表未来出现的结果的promise对象</p> <p>一个 Promise有以下几种状态:</p> <ul><li>pending: 初始状态，既不是成功，也不是失败状态。</li> <li>fulfilled: 意味着操作成功完成。</li> <li>rejected: 意味着操作失败。</li></ul> <p>pending 状态的 Promise 对象可能触发fulfilled 状态并传递一个值给相应的状态处理方法，也可能触发失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的 then 方法绑定的处理方法（handlers ）就会被调用（then方法包含两个参数：onfulfilled 和 onrejected，它们都是 Function 类型。当Promise状态为fulfilled时，调用 then 的 onfulfilled 方法，当Promise状态为rejected时，调用 then 的 onrejected 方法， 所以在异步操作的完成和绑定处理方法之间不存在竞争）。</p> <p>因为 Promise.prototype.then 和  Promise.prototype.catch 方法返回 promise 对象， 所以它们可以被链式调用。
<img src="https://mdn.mozillademos.org/files/8633/promises.png" alt="promise"></p> <h2 id="方法"><a href="#方法" aria-hidden="true" class="header-anchor">#</a> 方法</h2> <h3 id="promise-all-iterable"><a href="#promise-all-iterable" aria-hidden="true" class="header-anchor">#</a> Promise.all(iterable)</h3> <h4 id="描述：返回一个-promise-实例。此实例在-iterable-参数内-所有的-promise-都-完成（resolved）-或-参数中不包含-promise-时-回调完成（resolve）；如果参数中-promise-有一个失败（rejected），此实例回调失败（reject），失败原因的是第一个失败-promise-的结果。"><a href="#描述：返回一个-promise-实例。此实例在-iterable-参数内-所有的-promise-都-完成（resolved）-或-参数中不包含-promise-时-回调完成（resolve）；如果参数中-promise-有一个失败（rejected），此实例回调失败（reject），失败原因的是第一个失败-promise-的结果。" aria-hidden="true" class="header-anchor">#</a> 描述：返回一个 Promise 实例。此实例在 iterable 参数内 <em>所有的 promise 都 完成（resolved）</em> 或 <em>参数中不包含 promise 时</em> 回调完成（resolve）；如果参数中 promise 有一个失败（rejected），此实例回调失败（reject），失败原因的是第一个失败 promise 的结果。</h4> <h3 id="promise-race-iterable"><a href="#promise-race-iterable" aria-hidden="true" class="header-anchor">#</a> Promise.race(iterable)</h3> <h4 id="描述：返回一个-promise，一旦迭代器中的某个-promise-解决或拒绝，返回的-promise-就会解决或拒绝。"><a href="#描述：返回一个-promise，一旦迭代器中的某个-promise-解决或拒绝，返回的-promise-就会解决或拒绝。" aria-hidden="true" class="header-anchor">#</a> 描述：返回一个 promise，一旦迭代器中的某个 promise 解决或拒绝，返回的 promise 就会解决或拒绝。</h4> <h3 id="promise-reject-reason"><a href="#promise-reject-reason" aria-hidden="true" class="header-anchor">#</a> Promise.reject(reason)</h3> <h4 id="描述：返回一个带有拒绝原因reason参数的-promise-对象"><a href="#描述：返回一个带有拒绝原因reason参数的-promise-对象" aria-hidden="true" class="header-anchor">#</a> 描述：返回一个带有拒绝原因reason参数的 Promise 对象</h4> <h3 id="promise-resolve-value"><a href="#promise-resolve-value" aria-hidden="true" class="header-anchor">#</a> Promise.resolve(value)</h3> <h4 id="描述：返回一个以给定值解析后的-promise-对象。但如果这个值是个-thenable（即带有then方法），返回的promise会“跟随”这个thenable的对象，采用它的最终状态（指resolved-rejected-pending-settled）；如果传入的value本身就是promise对象，则该对象作为promise-resolve方法的返回值返回；否则以该值为成功状态返回promise对象。"><a href="#描述：返回一个以给定值解析后的-promise-对象。但如果这个值是个-thenable（即带有then方法），返回的promise会“跟随”这个thenable的对象，采用它的最终状态（指resolved-rejected-pending-settled）；如果传入的value本身就是promise对象，则该对象作为promise-resolve方法的返回值返回；否则以该值为成功状态返回promise对象。" aria-hidden="true" class="header-anchor">#</a> 描述：返回一个以给定值解析后的 Promise 对象。但如果这个值是个 thenable（即带有then方法），返回的promise会“跟随”这个thenable的对象，采用它的最终状态（指resolved/rejected/pending/settled）；如果传入的value本身就是promise对象，则该对象作为Promise.resolve方法的返回值返回；否则以该值为成功状态返回promise对象。</h4> <hr> <h3 id="catch"><a href="#catch" aria-hidden="true" class="header-anchor">#</a> catch()</h3> <p>一般来说，不要在then方法里面定义 Reject 状态的回调函数（即then的第二个参数），总是使用catch方法。</p> <hr> <h3 id="then"><a href="#then" aria-hidden="true" class="header-anchor">#</a> then()</h3> <h4 id="描述：为-promise-实例添加状态改变时的回调函数"><a href="#描述：为-promise-实例添加状态改变时的回调函数" aria-hidden="true" class="header-anchor">#</a> 描述：为 Promise 实例添加状态改变时的回调函数</h4> <h4 id="参数：-resolvedfn-：异步成功的回调函数；-rejectedfn-：异步失败的回调函数"><a href="#参数：-resolvedfn-：异步成功的回调函数；-rejectedfn-：异步失败的回调函数" aria-hidden="true" class="header-anchor">#</a> 参数：[resolvedFn]：异步成功的回调函数；[rejectedFn]：异步失败的回调函数</h4> <h4 id="返回值：返回一个新的promise实例"><a href="#返回值：返回一个新的promise实例" aria-hidden="true" class="header-anchor">#</a> 返回值：返回一个新的Promise实例</h4> <hr> <h3 id="finally"><a href="#finally" aria-hidden="true" class="header-anchor">#</a> finally()</h3> <h2 id="创建-promise"><a href="#创建-promise" aria-hidden="true" class="header-anchor">#</a> 创建 Promise</h2> <h3 id="promise-对象是由关键字-new-及其构造函数来创建的"><a href="#promise-对象是由关键字-new-及其构造函数来创建的" aria-hidden="true" class="header-anchor">#</a> Promise 对象是由关键字 new 及其构造函数来创建的</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myPro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行异步操作</span>
  <span class="token comment">// 异步任务顺利完成且返回结果值时，会调用 resolve 函数</span>
  <span class="token comment">// resolve(result)</span>
  <span class="token comment">// 当异步任务失败且返回失败原因（通常是一个错误对象）时，会调用reject 函数</span>
  <span class="token comment">// reject(result)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="想要让某个函数拥有-promise-功能，只需让其返回一个-promise-即可"><a href="#想要让某个函数拥有-promise-功能，只需让其返回一个-promise-即可" aria-hidden="true" class="header-anchor">#</a> 想要让某个函数拥有 promise 功能，只需让其返回一个 promise 即可</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myAsyncFunction</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="一个简单的例子"><a href="#一个简单的例子" aria-hidden="true" class="header-anchor">#</a> 一个简单的例子</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myPro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//当异步代码执行成功时，我们才会调用resolve(...), 当异步代码失败时就会调用reject(...)</span>
  <span class="token comment">//在本例中，我们使用setTimeout(...)来模拟异步代码，实际编码时可能是XHR请求或是HTML5的一些API方法.</span>
  <span class="token keyword">let</span> data
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'djlun'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//代码正常执行！</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myPro<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//successMessage的值是上面调用resolve(...)方法传入的值.</span>
  <span class="token comment">//successMessage参数不一定非要是字符串类型，这里只是举个例子</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;success:&quot;</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="一个高级一点的例子"><a href="#一个高级一点的例子" aria-hidden="true" class="header-anchor">#</a> 一个高级一点的例子</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> testPromise<span class="token punctuation">)</span>
<span class="token keyword">let</span> promiseCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">testPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> thisPromiseCount <span class="token operator">=</span> <span class="token operator">++</span>promiseCount<span class="token punctuation">;</span>
  <span class="token keyword">let</span> log <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  log<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>thisPromiseCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) 开始 (&lt;small&gt;同步代码开始&lt;/small&gt;)&lt;br/&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 新构建一个 Promise 实例：使用Promise实现每过一段时间给计数器加一的过程，每段时间间隔为1~3秒不等</span>
  <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>thisPromiseCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) Promise 开始 (&lt;small&gt;异步代码开始&lt;/small&gt;)&lt;br/&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>thisPromiseCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span> <span class="token operator">+</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Promise 不论成功或失败都会调用 then</span>
  <span class="token comment">// catch() 只有当 promise 失败时才会调用</span>
  p1
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) Promise 已填充完毕 (&lt;small&gt;异步代码结束&lt;/small&gt;)&lt;br/&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'处理失败的 promise ('</span><span class="token operator">+</span>reason<span class="token operator">+</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  log<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>thisPromiseCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) Promise made (&lt;small&gt;同步代码结束&lt;/small&gt;)&lt;br/&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="使用-promise"><a href="#使用-promise" aria-hidden="true" class="header-anchor">#</a> 使用 Promise</h2> <h3 id="什么是-promise？"><a href="#什么是-promise？" aria-hidden="true" class="header-anchor">#</a> 什么是 Promise？</h3> <p>MDN 这么说：</p> <ul><li><p>用于表示一个异步操作的最终状态（完成或失败），以及其返回的值。</p></li> <li><p>一个 Promise 就是一个代表了异步操作最终完成或者失败的结果对象</p></li> <li><p>Promise 本质上是一个绑定了回调的对象，而不是将回调传进函数内部</p></li></ul> <p><a href="http://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener noreferrer">阮一峰这么说：<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。</li> <li>所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。</li> <li>Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理</li> <li>Promise 对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）</li> <li>Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果，这时就称为 resolved（已定型）。如果改变已经发生了，你再对Promise对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。</li> <li>有了Promise对象，就可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。</li> <li>此外，Promise对象提供统一的接口，使得控制异步操作更加容易。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 生成一个Promise实例</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// then方法可以接受两个回调函数作为参数。</span>
<span class="token comment">// 第一个回调函数是Promise对象的状态变为resolved时调用，第二个回调函数是Promise对象的状态变为rejected时调用。</span>
<span class="token comment">// 其中，第二个函数是可选的，不一定要提供。</span>
<span class="token comment">// 这两个函数都接受Promise对象传出的值作为参数。</span>
promise
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// failure</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 下面代码中，Promise 新建后立即执行，所以首先输出的是Promise。然后，then方法指定的回调函数，将在当前脚本所有同步任务执行完才会执行，所以resolved最后输出。</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolved.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Promise</span>
<span class="token comment">// Hi!</span>
<span class="token comment">// resolved. </span>
</code></pre></div><p>异步加载图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadImageAsync</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    image<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Could not load image at '</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    image<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1548222934344&amp;di=c802ba6a85d1efda1ccc9d71a058e704&amp;imgtype=0&amp;src=http%3A%2F%2Fimgsrc.baidu.com%2Fimgad%2Fpic%2Fitem%2Fd1a20cf431adcbef1da6b62ba7af2edda3cc9f09.jpg'</span>
<span class="token function">loadImageAsync</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// &lt;img width=&quot;100&quot; height=&quot;100&quot; src=&quot;https://timgsa.baidu.com/timg?image&amp;amp;quality=80&amp;amp;size=b9999_10000&amp;amp;sec=1548222934344&amp;amp;di=c802ba6a85d1efda1ccc9d71a058e704&amp;amp;imgtype=0&amp;amp;src=http%3A%2F%2Fimgsrc.baidu.com%2Fimgad%2Fpic%2Fitem%2Fd1a20cf431adcbef1da6b62ba7af2edda3cc9f09.jpg&quot;&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>用Promise对象实现的 Ajax 操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getJSON</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">!==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;./posts.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token comment">// {code: 0, msg: &quot;success&quot;, data: {…}}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Contents: '</span> <span class="token operator">+</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Contents: [object Object]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上面代码中，getJSON是对 XMLHttpRequest 对象的封装，用于发出一个针对 JSON 数据的 HTTP 请求，并且返回一个Promise对象。</span>

<span class="token comment">// then方法返回的依然是一个Promise，依旧可以使用then方法</span>
<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;./posts.json&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token comment">// {code: 0, msg: &quot;success&quot;, data: {…}}</span>
  <span class="token keyword">return</span> json<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token comment">// {code: 0, msg: &quot;success&quot;, data: {…}}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第一个then还可以是返回一个新的Promise，那么后一个Promise会根据这个新的Promise的结果来执行</span>
<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;./posts.json&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>commentURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">funcA</span><span class="token punctuation">(</span>comments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;resolved: &quot;</span><span class="token punctuation">,</span> comments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// resolved:  {data: Array(1)}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">funcB</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rejected: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>resolve函数的参数除了正常的值以外，还可能是另一个 Promise 实例，比如像下面这样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token comment">/* new Error('fail') */</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p2
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`success: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// error: fail </span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2</span>
<span class="token comment">// 1</span>
<span class="token comment">// 上面代码中，调用resolve(1)以后，后面的console.log(2)还是会执行，并且会首先打印出来。这是因为立即 resolved 的 Promise 是在本轮事件循环的末尾执行，总是晚于本轮循环的同步任务</span>

<span class="token comment">// 一般来说，调用resolve或reject以后，Promise 的使命就完成了，后继操作应该放到then方法里面，而不应该直接写在resolve或reject的后面。所以，最好在它们前面加上return语句，这样就不会有意外</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 后面的语句不会执行</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="没有-promise-之前？"><a href="#没有-promise-之前？" aria-hidden="true" class="header-anchor">#</a> 没有 Promise 之前？</h3> <p>假设存在一个名为 createAudioFileAsync() 的函数，这个函数异步地生成声音文件，在声音文件创建成功或者创建失败后执行回调函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> suc <span class="token operator">=</span> <span class="token punctuation">{</span>
  code<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  msg<span class="token punctuation">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">'bangbangbnag.mp3'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> err <span class="token operator">=</span> <span class="token punctuation">{</span>
  code<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  msg<span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createAudioFileAsync</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> sucFn<span class="token punctuation">,</span> errFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sucFn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">errFn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 成功的回调函数</span>
<span class="token keyword">function</span> <span class="token function">successCallback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;声音文件创建成功: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 失败的回调函数</span>
<span class="token keyword">function</span> <span class="token function">failureCallback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;声音文件创建失败: &quot;</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">createAudioFileAsync</span><span class="token punctuation">(</span>suc<span class="token punctuation">,</span> successCallback<span class="token punctuation">,</span> failureCallback<span class="token punctuation">)</span> <span class="token comment">// 声音文件创建成功: bangbangbnag.mp3</span>
<span class="token function">createAudioFileAsync</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> successCallback<span class="token punctuation">,</span> failureCallback<span class="token punctuation">)</span> <span class="token comment">// 声音文件创建失败: error</span>
</code></pre></div><h3 id="使用-promise-的好处？"><a href="#使用-promise-的好处？" aria-hidden="true" class="header-anchor">#</a> 使用 Promise 的好处？</h3> <h4 id="_1-链式调用："><a href="#_1-链式调用：" aria-hidden="true" class="header-anchor">#</a> 1. 链式调用：</h4> <h4 id="需求：连续执行两个或者多个异步操作，每一个后来的操作都在前面的操作执行成功之后，带着上一步操作所返回的结果开始执行。我们可以通过创造一个-promise-chain-来完成这种需求。"><a href="#需求：连续执行两个或者多个异步操作，每一个后来的操作都在前面的操作执行成功之后，带着上一步操作所返回的结果开始执行。我们可以通过创造一个-promise-chain-来完成这种需求。" aria-hidden="true" class="header-anchor">#</a> 需求：连续执行两个或者多个异步操作，每一个后来的操作都在前面的操作执行成功之后，带着上一步操作所返回的结果开始执行。我们可以通过创造一个 Promise chain 来完成这种需求。</h4> <h3 id="怎样使用-promise？"><a href="#怎样使用-promise？" aria-hidden="true" class="header-anchor">#</a> 怎样使用 Promise？</h3> <p><a href="https://www.jianshu.com/p/29da9aef4c1c" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
需求：一个函数，一秒后打印“我是一秒后打印的文字”，二秒后打印“我是二秒后打印的文字”，三秒后打印“我是三秒后打印的文字”</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 过去，回调地狱</span>


</code></pre></div><p>then函数会返回一个新的Promise变量，可以再次调用这个新的Promise变量的then函数</p> <p>而then函数返回的是什么样的Promies，取决于onFulfilled回调的返回值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用 Promise</span>
</code></pre></div><h3 id="如何创建-promise？"><a href="#如何创建-promise？" aria-hidden="true" class="header-anchor">#</a> 如何创建 Promise？</h3></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/jsdoc/bibao.html" class="prev">
          闭包
        </a></span> <span class="next"><a href="/jsdoc/async.html">
          async await || yield function*
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.74b9e2df.js" defer></script><script src="/assets/js/25.446a0ad5.js" defer></script>
  </body>
</html>
